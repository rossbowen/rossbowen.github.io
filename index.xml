<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Ross Bowen</title>
<link>https://rossbowen.github.io/</link>
<atom:link href="https://rossbowen.github.io/index.xml" rel="self" type="application/rss+xml"/>
<description></description>
<generator>quarto-1.4.553</generator>
<lastBuildDate>Mon, 27 May 2024 23:00:00 GMT</lastBuildDate>
<item>
  <title>Exploring expert systems</title>
  <link>https://rossbowen.github.io/blog/exploring-expert-systems/</link>
  <description><![CDATA[ 




<p>I’ve been reading <a href="https://sqlpatterns.com/p/debugging-your-business-with-data">Data Patterns</a> recently and I caught a line about trying to build a causal model of a business in order to understand it better.</p>
<blockquote class="blockquote">
<p>What I’m drawn to in particular is how the metric tree concept is really a way of expressing a causal model of how a business works. As my friend Cedric Chin says, “The purpose of becoming data driven is to build a causal model of the business in your head. The purpose of doing all this work is that you want to understand how your business actually works and grows, not rely on superstitious beliefs about how your business works and grows.”</p>
</blockquote>
<p>This idea got me thinking about causal inference and I recalled a toy expert system used to determine if a patient has dyspnoea (shortness of breath). I found <a href="https://www.eecis.udel.edu/~shatkay/Course/papers/Lauritzen1988.pdf">the original paper</a> and decided to replicate the results using Stan.</p>
<p>The idea behind the system is:</p>
<blockquote class="blockquote">
<p>Shortness-of-breath (dyspnoea) may be due to tuberculosis, lung cancer or bronchitis, or none of them, or more than one of them. A recent visit to Asia increases the chances of tuberculosis, while smoking is known to be a risk factor for both lung cancer and bronchitis. The results of a single chest X-ray do not discriminate between lung cancer and tuberculosis, as neither does the presence or absence of dyspnoea.</p>
</blockquote>
<p>This description leads to a causal Directed Acyclic Graph (DAG) that shows the dependencies among different traits.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart
    A[visit to Asia?] --&gt; T[tuberculosis?]
    S[smoking?] --&gt; L[lung cancer?]
    S --&gt; B[bronchitis?]
    T --&gt; E[either tuberculosis or lung cancer?]
    L --&gt; E
    E --&gt; X[positive X-ray?]
    E --&gt; D[dyspnoea?]
    B --&gt; D
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>These DAGs help us understand the dependencies between different traits and ask interesting questions about the system. The paper mentions several scenarios:</p>
<blockquote class="blockquote">
<p>A patient presents at a chest clinic with dyspnoea, and has recently visited Asia. Smoking history and chest X-ray are not yet available. The doctor would like to know the chance that each of the diseases is present, and if tuberculosis were ruled out by another test, how would that change the belief in lung cancer? Also, would knowing smoking history or getting an X-ray contribute most information about cancer, given that smoking may ‘explain away’ the dyspnoea since bronchitis is considered a possibility? Finally, when all information is in, can we identify which was the most influential in forming our judgement?</p>
</blockquote>
<p>We aim to simulate data using the model and relationships described in the paper. From these samples, we can estimate the probabilities for each of the questions posed.</p>
<section id="model-specification" class="level2">
<h2 class="anchored" data-anchor-id="model-specification">Model specification</h2>
<p>The paper provides several conditional probabilities:</p>
<ol type="1">
<li>The probability of someone visiting Asia is 0.01, and the probability of someone smoking is 0.5.</li>
</ol>
<p><img src="https://latex.codecogs.com/png.latex?%20P(%5Ctext%7Basia%7D%20=%201)%20=%200.01%20"></p>
<p><img src="https://latex.codecogs.com/png.latex?%20P(%5Ctext%7Bsmoking%7D%20=%201)%20=%200.5%20"></p>
<ol start="2" type="1">
<li>If someone has visited Asia, the probability of tuberculosis is 0.05. If they have not visited Asia, the probability is 0.01.</li>
</ol>
<p><img src="https://latex.codecogs.com/png.latex?%20P(%5Ctext%7Btuberculosis%7D%20=%201%20%5Cmid%20%5Ctext%7Basia%7D%20=%201)%20=%200.05%20"> <img src="https://latex.codecogs.com/png.latex?%20P(%5Ctext%7Btuberculosis%7D%20=%201%20%5Cmid%20%5Ctext%7Basia%7D%20=%200)%20=%200.01%20"></p>
<ol start="3" type="1">
<li>If someone smokes, the probability of lung cancer is 0.1. If they do not smoke, the probability is 0.01.</li>
</ol>
<p><img src="https://latex.codecogs.com/png.latex?%20P(%5Ctext%7Blung%20cancer%7D%20=%201%20%5Cmid%20%5Ctext%7Bsmoking%7D%20=%201)%20=%200.1%20"> <img src="https://latex.codecogs.com/png.latex?%20P(%5Ctext%7Blung%20cancer%7D%20=%201%20%5Cmid%20%5Ctext%7Bsmoking%7D%20=%200)%20=%200.01%20"></p>
<ol start="4" type="1">
<li>If someone smokes, the probability of bronchitis is 0.6. If they do not smoke, the probability is 0.3.</li>
</ol>
<p><img src="https://latex.codecogs.com/png.latex?%20P(%5Ctext%7Bbronchitis%7D%20=%201%20%5Cmid%20%5Ctext%7Bsmoking%7D%20=%201)%20=%200.6%20"> <img src="https://latex.codecogs.com/png.latex?%20P(%5Ctext%7Bbronchitis%7D%20=%201%5Cmid%20%5Ctext%7Bsmoking%7D%20=%200)%20=%200.3%20"></p>
<ol start="5" type="1">
<li>Having either tuberculosis or lung cancer is represented by the event “either”.</li>
</ol>
<p><img src="https://latex.codecogs.com/png.latex?%20%5C%7B%20%5Ctext%7Beither%7D%20=%201%20%5C%7D%20=%20%5C%7B%20%5Ctext%7Btuberculosis%7D%20=%201%20%5C%7D%20%5Cvee%20%5C%7B%20%5Ctext%7Blung%20cancer%7D%20=%201%20%5C%7D%20"></p>
<ol start="6" type="1">
<li>If someone has either tuberculosis or lung cancer, the probability of a positive x-ray is 0.98. If they do not have either, the probability is 0.05. This can be interpreted as the x-ray having 98% sensitivity and 95% specificity.</li>
</ol>
<p><img src="https://latex.codecogs.com/png.latex?%20P(%5Ctext%7Bx-ray%7D%20=%201%20%5Cmid%20%5Ctext%7Beither%7D%20=%201)%20=%200.98%20"> <img src="https://latex.codecogs.com/png.latex?%20P(%5Ctext%7Bx-ray%7D%20=%201%20%5Cmid%20%5Ctext%7Beither%7D%20=%200)%20=%200.05%20"></p>
<ol start="7" type="1">
<li>Finally, if someone has either tuberculosis or lung cancer and also has bronchitis, the probability of dyspnoea is 0.9. If they have either but not bronchitis, the probability is 0.7. If they do not have either but do have bronchitis, the probability is 0.8. If they have neither and do not have bronchitis, the probability is 0.1.</li>
</ol>
<p><img src="https://latex.codecogs.com/png.latex?%20P(%5Ctext%7Bdyspnoea%7D%20=%201%20%5Cmid%20%5Ctext%7Beither%7D%20=%201,%20%5Ctext%7Bbronchitis%7D%20=%201)%20=%200.9%20"> <img src="https://latex.codecogs.com/png.latex?%20P(%5Ctext%7Bdyspnoea%7D%20=%201%20%5Cmid%20%5Ctext%7Beither%7D%20=%201,%20%5Ctext%7Bbronchitis%7D%20=%200)%20=%200.7%20"> <img src="https://latex.codecogs.com/png.latex?%20P(%5Ctext%7Bdyspnoea%7D%20=%201%20%5Cmid%20%5Ctext%7Beither%7D%20=%200,%20%5Ctext%7Bbronchitis%7D%20=%201)%20=%200.8%20"> <img src="https://latex.codecogs.com/png.latex?%20P(%5Ctext%7Bdyspnoea%7D%20=%201%20%5Cmid%20%5Ctext%7Beither%7D%20=%200,%20%5Ctext%7Bbronchitis%7D%20=%200)%20=%200.1%20"></p>
</section>
<section id="simulating" class="level2">
<h2 class="anchored" data-anchor-id="simulating">Simulating</h2>
<p>I remembered <a href="https://chjackson.github.io/openbugsdoc/Examples/Asia.html">an old WinBUGS simulation which used this model</a>. The WinBUGS documentation was hard to find, but luckily <a href="https://github.com/chjackson"><code>@chjackson</code></a> has mirrored it on GitHub. Unfortunately, this example is missing from the <a href="https://github.com/stan-dev/example-models">example models</a> Stan repository.</p>
<p>The WinBUGS simulation chooses to specify each trait as a categorical variable with two categories, instead of modelling them as Bernoulli random variables - I’d guess to make it easier to specify the conditional probabilities.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">model</span>
<span id="cb1-2">{</span>
<span id="cb1-3">    smoking <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dcat</span>(p.smoking[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span>
<span id="cb1-4">    tuberculosis <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dcat</span>(p.tuberculosis[asia,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span>
<span id="cb1-5">    lung.cancer <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dcat</span>(p.lung.cancer[smoking,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span>
<span id="cb1-6">    bronchitis <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dcat</span>(p.bronchitis[smoking,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span>
<span id="cb1-7">    either <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(tuberculosis,lung.cancer)</span>
<span id="cb1-8">    xray <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dcat</span>(p.xray[either,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span>
<span id="cb1-9">    dyspnoea <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dcat</span>(p.dyspnoea[either,bronchitis,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span>
<span id="cb1-10">}</span></code></pre></div>
<p>In this example, all parameters are known and included as data, so there are no unknown probabilistic parameters like in a typical Stan simulation. The Stan guidance has a section on <a href="https://mc-stan.org/docs/reference-manual/mcmc.html#sampling-without-parameters">sampling without parameters</a> which shows how we can use a <code>generated quantities</code> block to create data based on the model.</p>
<div class="cell" data-output.var="model">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">data</span> {</span>
<span id="cb2-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">real</span>&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lower</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">upper</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>&gt; p_asia;                  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// 0.01</span></span>
<span id="cb2-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">real</span>&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lower</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">upper</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>&gt; p_smoking;               <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// 0.5</span></span>
<span id="cb2-4"></span>
<span id="cb2-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// The following are the conditional probabilities</span></span>
<span id="cb2-6">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">array</span>[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">real</span>&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lower</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">upper</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>&gt; p_tuberculosis; <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// 0.01, 0.05</span></span>
<span id="cb2-7">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">array</span>[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">real</span>&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lower</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">upper</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>&gt; p_lung_cancer;  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// 0.01, 0.1</span></span>
<span id="cb2-8">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">array</span>[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">real</span>&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lower</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">upper</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>&gt; p_bronchitis;   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// 0.3, 0.6</span></span>
<span id="cb2-9">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">array</span>[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">real</span>&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lower</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">upper</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>&gt; p_xray;         <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// 0.05, 0.98</span></span>
<span id="cb2-10">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">array</span>[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">real</span>&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lower</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">upper</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>&gt; p_dyspnoea;  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// 0.1, 0.8, 0.7, 0.9</span></span>
<span id="cb2-11">}</span>
<span id="cb2-12"></span>
<span id="cb2-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">generated quantities</span> {</span>
<span id="cb2-14">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span>&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lower</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">upper</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>&gt; asia = bernoulli_rng(p_asia);</span>
<span id="cb2-15">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span>&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lower</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">upper</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>&gt; smoking = bernoulli_rng(p_smoking);</span>
<span id="cb2-16">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span>&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lower</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">upper</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>&gt; tuberculosis = bernoulli_rng(p_tuberculosis[asia + <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]);</span>
<span id="cb2-17">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span>&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lower</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">upper</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>&gt; lung_cancer = bernoulli_rng(p_lung_cancer[smoking + <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]);</span>
<span id="cb2-18">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span>&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lower</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">upper</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>&gt; bronchitis = bernoulli_rng(p_bronchitis[smoking + <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]);</span>
<span id="cb2-19">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span>&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lower</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">upper</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>&gt; either = max(tuberculosis, lung_cancer);</span>
<span id="cb2-20">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span>&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lower</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">upper</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>&gt; xray = bernoulli_rng(p_xray[either + <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]);</span>
<span id="cb2-21">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span>&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lower</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">upper</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>&gt; dyspnoea = bernoulli_rng(p_dyspnoea[either + <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, bronchitis + <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]);</span>
<span id="cb2-22">}</span></code></pre></div>
</div>
<p>We use indexing to retrieve the appropriate conditional probability at each step. For example, if <code>asia == 0</code> then <code>tuberculosis = bernoulli_rng(p_tuberculosis[1])</code>, but if <code>asia == 1</code> then <code>tuberculosis = bernoulli_rng(p_tuberculosis[2])</code>.</p>
<p>We run the model with <code>rstan</code> to generate our samples.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rstan)</span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb3-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyr)</span>
<span id="cb3-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">options</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mc.cores =</span> parallel<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">detectCores</span>())</span>
<span id="cb3-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rstan_options</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">auto_write =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb3-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)</span>
<span id="cb3-7"></span>
<span id="cb3-8">data_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb3-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p_asia         =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>,</span>
<span id="cb3-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p_smoking      =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,</span>
<span id="cb3-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p_tuberculosis =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>),</span>
<span id="cb3-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p_lung_cancer  =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>),</span>
<span id="cb3-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p_bronchitis   =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>),</span>
<span id="cb3-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p_xray         =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.98</span>),</span>
<span id="cb3-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p_dyspnoea     =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">byrow =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb3-16">)</span>
<span id="cb3-17"></span>
<span id="cb3-18">fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sampling</span>(</span>
<span id="cb3-19">  model,</span>
<span id="cb3-20">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data_list,</span>
<span id="cb3-21">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">iter =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100000</span>,</span>
<span id="cb3-22">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">chains =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb3-23">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">algorithm =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fixed_param"</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Needed for sampling without parameters</span></span>
<span id="cb3-24">)</span>
<span id="cb3-25"></span>
<span id="cb3-26"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(fit)</span>
<span id="cb3-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Inference for Stan model: anon_model.</span></span>
<span id="cb3-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 4 chains, each with iter=1e+05; warmup=50000; thin=1; </span></span>
<span id="cb3-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; post-warmup draws per chain=50000, total post-warmup draws=2e+05.</span></span>
<span id="cb3-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; </span></span>
<span id="cb3-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;              mean se_mean   sd 2.5% 25% 50% 75% 97.5%  n_eff Rhat</span></span>
<span id="cb3-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; asia         0.01       0 0.10    0   0   0   0     0 198070    1</span></span>
<span id="cb3-33"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; smoking      0.50       0 0.50    0   0   1   1     1 200360    1</span></span>
<span id="cb3-34"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; tuberculosis 0.01       0 0.10    0   0   0   0     0 199880    1</span></span>
<span id="cb3-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; lung_cancer  0.06       0 0.23    0   0   0   0     1 195044    1</span></span>
<span id="cb3-36"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; bronchitis   0.45       0 0.50    0   0   0   1     1 198390    1</span></span>
<span id="cb3-37"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; either       0.07       0 0.25    0   0   0   0     1 196256    1</span></span>
<span id="cb3-38"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; xray         0.11       0 0.31    0   0   0   0     1 198948    1</span></span>
<span id="cb3-39"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; dyspnoea     0.44       0 0.50    0   0   0   1     1 199239    1</span></span>
<span id="cb3-40"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; lp__         0.00     NaN 0.00    0   0   0   0     0    NaN  NaN</span></span>
<span id="cb3-41"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; </span></span>
<span id="cb3-42"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Samples were drawn using (diag_e) at Mon Jun  3 23:07:42 2024.</span></span>
<span id="cb3-43"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; For each parameter, n_eff is a crude measure of effective sample size,</span></span>
<span id="cb3-44"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; and Rhat is the potential scale reduction factor on split chains (at </span></span>
<span id="cb3-45"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; convergence, Rhat=1).</span></span></code></pre></div>
</div>
<p>The simulation ran successfully, and the <code>mean</code> column of the summary gives the marginal probabilities for each of the traits in the system. Let’s take a look at our samples:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rstan<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">extract</span>(fit)</span>
<span id="cb4-2">samples <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tibble<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_tibble</span>(params)</span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(samples)</span>
<span id="cb4-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 200,000 × 9</span></span>
<span id="cb4-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;     asia smoking tuberculosis lung_cancer bronchitis either  xray dyspnoea  lp__</span></span>
<span id="cb4-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    &lt;dbl&gt; &lt;dbl[1&gt;    &lt;dbl[1d]&gt;   &lt;dbl[1d]&gt;  &lt;dbl[1d]&gt; &lt;dbl[&gt; &lt;dbl&gt; &lt;dbl[1d&gt; &lt;dbl&gt;</span></span>
<span id="cb4-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  1     0       0            0           0          0      0     0        0     0</span></span>
<span id="cb4-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  2     0       1            0           1          1      1     1        1     0</span></span>
<span id="cb4-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  3     0       0            0           0          0      0     0        0     0</span></span>
<span id="cb4-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  4     0       0            0           0          0      0     0        0     0</span></span>
<span id="cb4-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  5     0       1            0           0          1      0     0        1     0</span></span>
<span id="cb4-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  6     0       1            1           0          0      1     1        1     0</span></span>
<span id="cb4-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  7     0       1            0           0          1      0     0        1     0</span></span>
<span id="cb4-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  8     0       0            0           0          1      0     0        1     0</span></span>
<span id="cb4-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;  9     0       0            0           0          0      0     0        0     0</span></span>
<span id="cb4-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 10     0       1            0           0          1      0     0        1     0</span></span>
<span id="cb4-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # ℹ 199,990 more rows</span></span></code></pre></div>
</div>
</section>
<section id="answering-some-questions" class="level2">
<h2 class="anchored" data-anchor-id="answering-some-questions">Answering some questions</h2>
<p>So now we have some simulated data, we can estimate probabilities by looking at the proportion of samples which meet certain conditions. First, let’s do some sense checks to make sure our simulated data gives results we’d expect from the model specification.</p>
<p>The model specification says the probability of someone having visited Asia is 0.01, and the probability that someone smokes is 0.5. Our samples agree with this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">samples <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(</span>
<span id="cb5-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">asia_prob =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(asia),</span>
<span id="cb5-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">smoking_prob =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(smoking)</span>
<span id="cb5-5">  )</span>
<span id="cb5-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 1 × 2</span></span>
<span id="cb5-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   asia_prob smoking_prob</span></span>
<span id="cb5-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;       &lt;dbl&gt;        &lt;dbl&gt;</span></span>
<span id="cb5-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1   0.00952        0.504</span></span></code></pre></div>
</div>
<p>To check another, the model specification says that if someone smokes, the probability they have lung cancer is 0.1. If they do not smoke, the probability is 0.01. Our samples agree with this too, so it looks like our simulation has behaved as expected.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">samples <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(smoking) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lung_cancer_prob =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(lung_cancer))</span>
<span id="cb6-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 2 × 2</span></span>
<span id="cb6-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   smoking lung_cancer_prob</span></span>
<span id="cb6-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;     &lt;dbl&gt;            &lt;dbl&gt;</span></span>
<span id="cb6-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1       0          0.00957</span></span>
<span id="cb6-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2       1          0.101</span></span></code></pre></div>
</div>
<p>Now we can answer the questions from the paper:</p>
<blockquote class="blockquote">
<p>A patient presents at a chest clinic with dyspnoea, and has recently visited Asia. Smoking history and chest X-ray are not yet available. The doctor would like to know the chance that each of the diseases is present.</p>
</blockquote>
<p>Here we’ll want to filter to samples where <code>asia == 1</code> and <code>dyspnoea == 1</code>, and to look at the occurrence of each of the other traits.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">samples <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>lp__) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(asia <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, dyspnoea <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb7-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make each instance of a disease appear on its own line</span></span>
<span id="cb7-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>asia,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>dyspnoea), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trait"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb7-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(trait) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb7-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">probability =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(value))</span>
<span id="cb7-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 6 × 2</span></span>
<span id="cb7-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   trait        probability</span></span>
<span id="cb7-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   &lt;chr&gt;              &lt;dbl&gt;</span></span>
<span id="cb7-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1 bronchitis        0.803 </span></span>
<span id="cb7-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2 either            0.176 </span></span>
<span id="cb7-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 3 lung_cancer       0.0873</span></span>
<span id="cb7-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 4 smoking           0.643 </span></span>
<span id="cb7-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 5 tuberculosis      0.0931</span></span>
<span id="cb7-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 6 xray              0.217</span></span></code></pre></div>
</div>
<p>From this we can see it’s likely that the patient has bronchitis, and less likely that they have lung cancer or tuberculosis. It’s quite likely that the patient smokes, and less likely that a positive x-ray would be seen. The probabilities agree with what was <a href="https://chjackson.github.io/openbugsdoc/Examples/Asia.html">found in the WinBUGS simulation</a> (which are computed by taking one away from the <code>mean</code> in the reported table).</p>
<blockquote class="blockquote">
<p>…if tuberculosis were ruled out by another test, how would that change the belief in lung cancer?</p>
</blockquote>
<p>Here we filter for samples where <code>tuberculosis == 0</code> too.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">samples <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>lp__) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(asia <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, dyspnoea <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, tuberculosis <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>asia,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>dyspnoea), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trait"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(trait) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">probability =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(trait <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lung_cancer"</span>)</span>
<span id="cb8-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 1 × 2</span></span>
<span id="cb8-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   trait       probability</span></span>
<span id="cb8-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   &lt;chr&gt;             &lt;dbl&gt;</span></span>
<span id="cb8-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1 lung_cancer      0.0911</span></span></code></pre></div>
</div>
<p>The probability of lung cancer once we’ve ruled out tuberculosis hasn’t changed by much.</p>
<blockquote class="blockquote">
<p>Also, would knowing smoking history or getting an X-ray contribute most information about cancer, given that smoking may ‘explain away’ the dyspnoea since bronchitis is considered a possibility?</p>
</blockquote>
<p>Going back to the case where <code>asia == 1</code> and <code>dyspnoea == 1</code>, we can look at different cases for smoking history and x-ray results to see how that affects the probability of lung cancer.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">samples <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>lp__) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(asia <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, dyspnoea <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb9-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(smoking) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lung_cancer_prob =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(lung_cancer))</span>
<span id="cb9-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 2 × 2</span></span>
<span id="cb9-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   smoking lung_cancer_prob</span></span>
<span id="cb9-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;     &lt;dbl&gt;            &lt;dbl&gt;</span></span>
<span id="cb9-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1       0           0.0130</span></span>
<span id="cb9-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2       1           0.129</span></span>
<span id="cb9-11"></span>
<span id="cb9-12">samples <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb9-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>lp__) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb9-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(asia <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, dyspnoea <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb9-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(xray) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lung_cancer_prob =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(lung_cancer))</span>
<span id="cb9-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 2 × 2</span></span>
<span id="cb9-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;    xray lung_cancer_prob</span></span>
<span id="cb9-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   &lt;dbl&gt;            &lt;dbl&gt;</span></span>
<span id="cb9-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1     0            0    </span></span>
<span id="cb9-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2     1            0.403</span></span></code></pre></div>
</div>
<p>Here we can see that the x-ray result gives a stronger signal for the presence (or absence) of lung cancer presence than smoking history.</p>
<blockquote class="blockquote">
<p>Finally, when all information is in, can we identify which was the most influential in forming our judgement?</p>
</blockquote>
<p>So given <code>asia == 1</code> and <code>dyspnoea == 1</code>, we can look at the samples for different known smoking histories and different xray results and see what they do to the probabilities for each of the diseases.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">samples <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>lp__) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(asia <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, dyspnoea <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb10-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(smoking, xray) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb10-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(</span>
<span id="cb10-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tuberculosis_prob =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(tuberculosis),</span>
<span id="cb10-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lung_cancer_prob =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(lung_cancer),</span>
<span id="cb10-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bronchitis_prob =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(bronchitis)</span>
<span id="cb10-9">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb10-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(xray)</span>
<span id="cb10-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; `summarise()` has grouped output by 'smoking'. You can override using the</span></span>
<span id="cb10-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; `.groups` argument.</span></span>
<span id="cb10-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 4 × 5</span></span>
<span id="cb10-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # Groups:   smoking [2]</span></span>
<span id="cb10-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   smoking  xray tuberculosis_prob lung_cancer_prob bronchitis_prob</span></span>
<span id="cb10-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;     &lt;dbl&gt; &lt;dbl&gt;             &lt;dbl&gt;            &lt;dbl&gt;           &lt;dbl&gt;</span></span>
<span id="cb10-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1       0     0           0.004             0                0.772</span></span>
<span id="cb10-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2       1     0           0.00236           0                0.915</span></span>
<span id="cb10-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 3       0     1           0.667             0.0702           0.404</span></span>
<span id="cb10-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 4       1     1           0.310             0.550            0.674</span></span></code></pre></div>
</div>
<p>From these results, we see that a positive x-ray increases the probability of lung cancer and tuberculosis, regardless of smoking status, while smoking increases bronchitis likelihood regardless of the x-ray result. The x-ray result appears to be the most influential additional information here, as it causes the largest changes to probabilities of the different diseases.</p>


</section>

 ]]></description>
  <guid>https://rossbowen.github.io/blog/exploring-expert-systems/</guid>
  <pubDate>Mon, 27 May 2024 23:00:00 GMT</pubDate>
</item>
<item>
  <title>How long will my machine last?</title>
  <link>https://rossbowen.github.io/blog/how-long-will-my-machine-last/</link>
  <description><![CDATA[ 




<p>When <a href="../../blog/confidence-intervals-in-the-wild">writing about confidence intervals</a> I came across <a href="https://bayes.wustl.edu/etj/articles/confidence.pdf">this 1974 paper</a> by E. T. Jaynes which had a nice problem about estimating the minimum lifetime of some machinery.</p>
<blockquote class="blockquote">
<p>EXAMPLE 5. TRUNCATED EXPONENTIAL DISTRIBUTION</p>
<p>The following problem has occurred in several industrial quality control situations. A device will operate without failure for a time <img src="https://latex.codecogs.com/png.latex?%5Ctheta"> because of a protective chemical inhibitor injected into it; but at time <img src="https://latex.codecogs.com/png.latex?%5Ctheta"> the supply of this chemical is exhausted, and failures then commence, following the exponential failure law.</p>
<p>It is not feasible to observe the depletion of this inhibitor directly; one can observe only the resulting failures. From data on actual failure times, estimate the time <img src="https://latex.codecogs.com/png.latex?%5Ctheta"> of guaranteed safe operation by a confidence interval. Here we have a continuous sample space, and we are to estimate a location parameter <img src="https://latex.codecogs.com/png.latex?%5Ctheta">, from the sample values <img src="https://latex.codecogs.com/png.latex?%7B%20x_1,%20x_2,%20%5Cldots%20x_n%20%7D">, distributed according to the law <img src="https://latex.codecogs.com/png.latex?%0Ap(dx%20%5Cmid%20%5Ctheta)%20=%0A%5Cbegin%7Bcases%7D%0A%20%20%5Cexp(%5Ctheta%20-%20x)%20dx%20&amp;%20x%20%3E%20%5Ctheta,%20%5C%5C%0A%20%200%20&amp;%20x%20%3C%20%5Ctheta%20.%0A%5Cend%7Bcases%7D%0A"></p>
</blockquote>
<p>I love this kind of “real life” problem. The paper makes the point that calculating a confidence interval is complicated and results in a completely unhelpful interval. It shows how a Bayesian approach gives much better results, but the paper jumps through to defining a posterior density without showing how it gets there. I wanted to work it though and thought it would be a chance to try out using <a href="https://mc-stan.org/">Stan</a>.</p>
<section id="some-maths" class="level2">
<h2 class="anchored" data-anchor-id="some-maths">Some maths</h2>
<p><a href="https://en.wikipedia.org/wiki/Poisson_point_process">Poisson processes</a> can be used to model the number of events which occur over time – things like the number of phonecalls received in a call centre, the number of people who walk into a shop, or the number of cars which pass you by as you walk down the street.</p>
<p>If we denote the number of events to occur up to some time <img src="https://latex.codecogs.com/png.latex?t"> as <img src="https://latex.codecogs.com/png.latex?N(t)">, then the probability that <img src="https://latex.codecogs.com/png.latex?N(t)%20=%20n"> is given by the Poisson distribution:</p>
<p><img src="https://latex.codecogs.com/png.latex?%20P(N(t)%20=%20n)%20=%20%5Cfrac%7B(%5Clambda%20t)%5En%7D%7Bn!%7D%20e%5E%7B-%5Clambda%20t%7D%20"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?%5Clambda"> is the rate of events per unit time.</p>
<p>In our example an event is the failure of a machine. We’re interested in the time of each failure which we label as <img src="https://latex.codecogs.com/png.latex?T_1,%20T_2,%20%5Cldots,%20T_N">. Each of these times is independent of the others.</p>
<p>We can notice that the event <img src="https://latex.codecogs.com/png.latex?T_1%20%3E%20t"> is equivalent to saying that no events occurred by time <img src="https://latex.codecogs.com/png.latex?t">, which is the same as saying <img src="https://latex.codecogs.com/png.latex?N(t)%20=%200">. So we can write</p>
<p><img src="https://latex.codecogs.com/png.latex?%20P(T_1%20%3E%20t)%20=%20P(N(t)%20=%200)%20=%20e%5E%7B-%5Clambda%20t%7D.%20"></p>
<p>Probabilities must sum to one, so we can also note</p>
<p><img src="https://latex.codecogs.com/png.latex?%20P(T_1%20%5Cleq%20t)%20=%201%20-%20P(T_1%20%3E%20t)%20=%201%20-%20e%5E%7B-%5Clambda%20t%7D.%20"></p>
<p>The result, <img src="https://latex.codecogs.com/png.latex?1%20-%20e%5E%7B-%5Clambda%20t%7D">, is the cumulative distribution function for an exponential distribution with rate <img src="https://latex.codecogs.com/png.latex?lambda">, with probability density function</p>
<p><img src="https://latex.codecogs.com/png.latex?%20p(t%20%5Cmid%20%5Clambda)%20=%20%5Clambda%20e%5E%7B-%5Clambda%20t%7D.%20"></p>
<p>This means that <img src="https://latex.codecogs.com/png.latex?T_1%20%5Csim%20%5Ctext%7BExponential%7D(%5Clambda)">. By using the <a href="https://en.wikipedia.org/wiki/Memorylessness">memorylessness</a> property of the exponential distribution we can say that all <img src="https://latex.codecogs.com/png.latex?T_1,%20T_2,%20T_3"> etc. are exponentially distributed.</p>
<hr>
<p>In our problem there’s an added constraint – the machines will run for a time <img src="https://latex.codecogs.com/png.latex?%5Ctheta"> before the chemical inhibitor is exhausted and failures begin. This means that the failure times have a lower bound – they will be at least <img src="https://latex.codecogs.com/png.latex?%5Ctheta"> – which leads us to describe the failure times as following a shifted exponential distribution</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ap(t%20%5Cmid%20%5Clambda,%20%5Ctheta)%20=%0A%5Cbegin%7Bcases%7D%0A%20%20%20%20%5Clambda%20%5Cexp(-%5Clambda%20(t%20-%20%5Ctheta))%20&amp;%20x%20%5Cgeq%20%5Ctheta,%20%5C%5C%0A%20%20%20%200%20&amp;%20x%20%3C%20%5Ctheta.%0A%5Cend%7Bcases%7D%0A"></p>
<p>If we set <img src="https://latex.codecogs.com/png.latex?%5Clambda%20=%201"> and multiply out the negative sign, this would be equivalent to the distribution given in the Jaynes paper.</p>
<p>We can see the effect of the shifting by plotting the probability density function for different values of <img src="https://latex.codecogs.com/png.latex?%5Ctheta">:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" data-startfrom="71" data-source-offset="-1" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 70;"><span id="cb1-71">x_length <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-72"></span>
<span id="cb1-73">viewof lambda <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Inputs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">range</span>([<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> {</span>
<span id="cb1-74">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">label</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tex</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">ext{lambda: }</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\l</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">ambda`</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-75">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">step</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-76">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">value</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-77">})<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-78">viewof theta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Inputs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">range</span>([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> x_length]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> {</span>
<span id="cb1-79">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">label</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tex</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">ext{theta: }</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">heta`</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-80">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">step</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-81">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">value</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-82">})<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-83">viewof t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Inputs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">range</span>([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> x_length]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> {</span>
<span id="cb1-84">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">label</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tex</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\P</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r(X </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\l</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">eq t): t`</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-85">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">step</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-86">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">value</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-87">})<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-88"></span>
<span id="cb1-89">x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Array</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">from</span>({ <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">length</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> x_length <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> }<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> (_<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> i) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">=&gt;</span> i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-90">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>((x_i) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">=&gt;</span> lambda <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Math</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>lambda <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (x_i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> theta)))<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-91">coordinates <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>((x_i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> i) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">=&gt;</span> {</span>
<span id="cb1-92">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> { <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">x</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> x_i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">y</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> (x_i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> theta) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> y[i] }<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-93">})<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-94"></span>
<span id="cb1-95">filteredCoordinates <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> coordinates<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>((coord) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">=&gt;</span> coord<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> t)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-96"></span>
<span id="cb1-97">Plot<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>({</span>
<span id="cb1-98">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">x</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> { <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">domain</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> x_length] }<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-99">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marks</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> [</span>
<span id="cb1-100">    Plot<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lineY</span>(coordinates<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> { <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">x</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">y</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span> })<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-101">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Add the stuff for the cumulative probability</span></span>
<span id="cb1-102">    Plot<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">areaY</span>(filteredCoordinates<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> {</span>
<span id="cb1-103">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">x</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-104">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">y</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-105">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">fill</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-106">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">fillOpacity</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-107">    })<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-108">    Plot<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lineY</span>(filteredCoordinates<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> {</span>
<span id="cb1-109">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">x</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-110">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">y</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-111">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">stroke</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-112">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">strokeWidth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-113">    })<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-114">    Plot<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ruleX</span>([[t]])<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-115">  ]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-116">})<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-9" data-nodetype="expression">

</div>
</div>
</div>
</div>
</section>
<section id="modelling-as-a-bayesian-problem" class="level2">
<h2 class="anchored" data-anchor-id="modelling-as-a-bayesian-problem">Modelling as a Bayesian problem</h2>
<p>The Jaynes paper derives a 90% credible interval for <img src="https://latex.codecogs.com/png.latex?%5Ctheta">. A 90% credible interval is a range of values where there’s a 90% chance that the actual value is within that range (a property which is not shared by confidence intervals!)</p>
<p>Our goal is to get a formula for the probability density of <img src="https://latex.codecogs.com/png.latex?%5Ctheta"> by using the observed failure times, so we can derive an interval for <img src="https://latex.codecogs.com/png.latex?%5Ctheta">.</p>
<p>The Jaynes paper derives the posterior probability density for <img src="https://latex.codecogs.com/png.latex?%5Ctheta"> as</p>
<blockquote class="blockquote">
<p><img src="https://latex.codecogs.com/png.latex?%0Ap(%5Ctheta%20%5Cmid%20x_1,%20x_2,%20%5Cldots%20x_N)%20=%20%5Cbegin%7Bcases%7D%0A%20%20N%5Cexp(N(%5Ctheta%20-%20%5Cmin(t))),%20&amp;%20%5Ctheta%20%3C%20%5Cmin(t),%20%5C%5C%0A%20%200,%20&amp;%20%5Ctheta%20%3E%20%5Cmin(t).%0A%5Cend%7Bcases%7D%0A"></p>
</blockquote>
<p>We can derive this using Bayes’ theorem,</p>
<p><img src="https://latex.codecogs.com/png.latex?%20p(%5Ctheta%20%5Cmid%20t_1,%20t_2,%20%5Cldots%20t_N)%20=%20%5Cfrac%7Bp(t_1,%20t_2,%20%5Cldots%20t_N%20%5Cmid%20%5Ctheta)p(%5Ctheta)%7D%7Bp(t_1,%20t_2,%20%5Cldots%20t_N)%7D.%20"></p>
<p>We choose a flat prior for <img src="https://latex.codecogs.com/png.latex?%5Ctheta">, such that <img src="https://latex.codecogs.com/png.latex?p(%5Ctheta)%20%5Cpropto%201"> and set <img src="https://latex.codecogs.com/png.latex?%5Clambda%20=%201"> throughout. Since <img src="https://latex.codecogs.com/png.latex?p(%5Ctheta)%20%5Cpropto%201"> and <img src="https://latex.codecogs.com/png.latex?p(t_1,%20t_2,%20%5Cldots%20t_N)"> doesn’t depend on <img src="https://latex.codecogs.com/png.latex?%5Ctheta">, we drop them as constants, ending up with</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ap(%5Ctheta%20%5Cmid%20t_1,%20t_2,%20%5Cldots%20t_N)%20%5Cpropto%20p(t_1,%20t_2,%20%5Cldots%20t_N%20%5Cmid%20%5Ctheta).%0A"></p>
<p>Using the independence of each failure time, we continue to simplify the expression:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign%7D%0A%20%20%20%20p(%5Ctheta%20%5Cmid%20t_1,%20t_2,%20%5Cldots%20t_N)%20&amp;%20%5Cpropto%20p(t_1,%20t_2,%20%5Cldots%20t_N%20%5Cmid%20%5Ctheta)%20%5C%5C%0A%20%20%20%20&amp;%5Cpropto%20%5Cprod_%7Bi=1%7D%5E%7BN%7D%20p(t_i%20%5Cmid%20%5Ctheta)%20%5C%5C%0A%20%20%20%20&amp;%5Cpropto%20%5Cprod_%7Bi=1%7D%5E%7BN%7D%20%5Cexp%7B(%5Ctheta%20-%20t_i)%7D%20%5Ccdot%20%5Cmathbb%7B1%7D%20%5C%7B%20t_i%20%5Cgeq%20%5Ctheta%20%5C%7D%0A%5Cend%7Balign%7D%0A"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7B1%7D%20%5C%7B%20t_i%20%5Cgeq%20%5Ctheta%20%5C%7D"> is the indicator function which is one if <img src="https://latex.codecogs.com/png.latex?t_i%20%5Cgeq%20%5Ctheta"> and zero otherwise. Continuing, we note that the union of the events <img src="https://latex.codecogs.com/png.latex?%5C%7B%20t_i%20%5Cgeq%20%5Ctheta%20%5C%7D"> is the same as the event <img src="https://latex.codecogs.com/png.latex?%5Cmin(t)%20%5Cgeq%20%5Ctheta">:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign%7D%0A%20%20%20%20p(%5Ctheta%20%5Cmid%20t_1,%20t_2,%20%5Cldots%20t_N)%20&amp;%5Cpropto%0A%20%20%20%20%20%20%20%20%5Cprod_%7Bi=1%7D%5E%7BN%7D%20%5Cexp%7B(%5Ctheta%20-%20t_i)%7D%20%5Ccdot%20%5Cmathbb%7B1%7D%20%5C%7B%20t_i%20%5Cgeq%20%5Ctheta%20%5C%7D%20%5C%5C%0A%20%20%20%20&amp;%20%5Cpropto%20e%5E%7BN%20%5Ctheta%7D%20%5Ccdot%20%5Cmathbb%7B1%7D%20%5C%7B%20%5Cmin(t)%20%5Cgeq%20%5Ctheta%20%5C%7D.%0A%5Cend%7Balign%7D%0A"></p>
<p>To get a probability distribution for <img src="https://latex.codecogs.com/png.latex?%5Ctheta">, we recall that probability distributions must integrate to one,</p>
<p><img src="https://latex.codecogs.com/png.latex?%20%5Cint_%7B-%5Cinfty%7D%5E%7B%5Cinfty%7D%20p(%5Ctheta%20%5Cmid%20t_1,%20t_2,%20%5Cldots%20t_N)%20d%5Ctheta%20=%201.%20"></p>
<p>We look to integrate our formula for <img src="https://latex.codecogs.com/png.latex?p(%5Ctheta%20%5Cmid%20t_1,%20t_2,%20%5Cldots%20t_N)">. We can use the result to form a probability density which integrates to one,</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign%7D%0A%5Cint_%7B-%5Cinfty%7D%5E%7B%5Cinfty%7D%20p(%5Ctheta%20%5Cmid%20t_1,%20t_2,%20%5Cldots%20t_N)%20d%5Ctheta%0A%20%20%20%20&amp;=%20%5Cint_%7B-%5Cinfty%7D%5E%7B%5Cinfty%7D%20e%5E%7BN%20%5Ctheta%7D%20%5Ccdot%20%5Cmathbb%7B1%7D%20%5C%7B%5Cmin(t)%20%5Cgeq%20%5Ctheta%20%5C%7D%20d%5Ctheta%20%5C%5C%0A%20%20%20%20&amp;=%20%5Cint_%7B-%5Cinfty%7D%5E%7B%5Cmin(t)%7D%20e%5E%7BN%20%5Ctheta%7D%20d%5Ctheta%20%5C%5C%0A%20%20%20%20&amp;=%20%5Cfrac%7B%5Cexp%7B(N%5Cmin(t))%7D%7D%7BN%7D%20.%0A%5Cend%7Balign%7D%0A"></p>
<p>If we divide our formula <img src="https://latex.codecogs.com/png.latex?e%5E%7BN%20%5Ctheta%7D%20%5Ccdot%20%5Cmathbb%7B1%7D%20%5C%7B%5Cmin(t)%20%5Cgeq%20%5Ctheta%20%5C%7D"> by <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cexp%7B(N%5Cmin(t))%7D%7D%7BN%7D"> we get a probability distribution for <img src="https://latex.codecogs.com/png.latex?%5Ctheta"> which integrates to one,</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ap(%5Ctheta%20%5Cmid%20t_1,%20t_2,%20%5Cldots%20t_N)%20=%0A%5Cbegin%7Bcases%7D%0A%20%20%20%20N%5Cexp(N(%5Ctheta%20-%20%5Cmin(t)))%20&amp;%20%5Ctext%7Bif%20%7D%20%5Ctheta%20%5Cleq%20%5Cmin(t),%20%5C%5C%0A%20%20%20%200%20&amp;%20%5Ctext%7Botherwise%7D%0A%5Cend%7Bcases%7D%0A"></p>
<p>which is the posterior probability given in the paper.</p>
</section>
<section id="deriving-a-credible-interval" class="level2">
<h2 class="anchored" data-anchor-id="deriving-a-credible-interval">Deriving a credible interval</h2>
<p>The paper provides three observed values for failure times: <img src="https://latex.codecogs.com/png.latex?%7Bt_1,%20t_2,%20t_3%7D%20=%20%7B12,%2014,%2016%7D">. From this it derives a 90% credible interval for <img src="https://latex.codecogs.com/png.latex?%5Ctheta"> of <img src="https://latex.codecogs.com/png.latex?11.23%20%3C%20%5Ctheta%20%3C%2012">; this is what we aim to reproduce.</p>
<p>The resulting formula we’re trying to solve is to find <img src="https://latex.codecogs.com/png.latex?L"> and <img src="https://latex.codecogs.com/png.latex?U"> such that</p>
<p><img src="https://latex.codecogs.com/png.latex?%20%5Cint_L%5EU%20p(%5Ctheta%20%5Cmid%20t_1,%20t_2,%20t_3)%20=%200.9.%20"></p>
<p>We know that <img src="https://latex.codecogs.com/png.latex?%5Ctheta%20%5Cleq%20%5Cmin(t)"> and want to find the <em>shortest</em> credible interval, which means targeting the interval over the area with the bulk of the probability density. Since most of the probability density is near <img src="https://latex.codecogs.com/png.latex?%5Cmin(t)">, we set <img src="https://latex.codecogs.com/png.latex?U%20=%20%5Cmin(t)%20=%2012">. Substituting in everything else, we can solve for <img src="https://latex.codecogs.com/png.latex?L">:</p>
<p><img src="https://latex.codecogs.com/png.latex?%20%5Cint_L%5E%7B12%7D%203%5Cexp(3(%5Ctheta%20-%2012))%20=%200.9.%20"></p>
<p>Let’s expand the integral:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign%7D%0A%20%20%20%20%5Cint_L%5E%7B12%7D%203%5Cexp(3(%5Ctheta%20-%2012))%20&amp;=%20%5Cexp(3(%5Ctheta%20-%2012))%20%5Cbig%7C_L%5E%7B12%7D%20%5C%5C%0A%20%20%20%20&amp;=%20%5Cvphantom%7B%5Cbig%7C_L%5E%7B12%7D%7D%20%5Cexp(0)%20-%20%5Cexp(3(L%20-%2012))%20%5C%5C%0A%20%20%20%20&amp;=%20%5Cvphantom%7B%5Cbig%7C_L%5E%7B12%7D%7D%201%20-%20%5Cexp(3(L%20-%2012)).%0A%5Cend%7Balign%7D%0A"></p>
<p>Finally, we solve for <img src="https://latex.codecogs.com/png.latex?L">:</p>
<p><img src="https://latex.codecogs.com/png.latex?%20%5Cbegin%7Balign%7D%201%20-%20%5Cexp(3(L%20-%2012))%20&amp;=%200.9%20%5C%5C%20&amp;%5Cimplies%20L%20=%2011.2325,%20%5Cend%7Balign%7D%20"></p>
<p>and with that, the interval we’ve computed is the same as Jaynes’:</p>
<p><img src="https://latex.codecogs.com/png.latex?%2011.23%20%3C%20%5Ctheta%20%3C%2012.%20"></p>
</section>
<section id="simulations-with-stan" class="level2">
<h2 class="anchored" data-anchor-id="simulations-with-stan">Simulations with Stan</h2>
<p>Sometimes, deriving a posterior probability density is hard, and it’s not always possible to do so analytically (i.e.&nbsp;to get a nice formula we can work with). In these cases, we can use a simulation approach to get a posterior probability density. Stan is a probabilistic programming language which allows us to do this by performing <a href="https://en.wikipedia.org/wiki/Markov_chain_Monte_Carlo">Markov chain Monte Carlo (MCMC)</a> sampling.</p>
<p>We write a Stan program to simulate the posterior probability density for <img src="https://latex.codecogs.com/png.latex?%5Ctheta"> given the observed values for failure times. Stan will simulate many possible values for <img src="https://latex.codecogs.com/png.latex?%5Ctheta">, and we can use these to approximate the posterior probability density.</p>
<div class="cell" data-output.var="model">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">data</span> {</span>
<span id="cb2-2">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span>&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lower</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>&gt; N;  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Number of observations, a non-negative integer.</span></span>
<span id="cb2-3">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">real</span>&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lower</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>&gt; t[N];  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Array of N observations, which are real numbers.</span></span>
<span id="cb2-4">}</span>
<span id="cb2-5"></span>
<span id="cb2-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">parameters</span> {</span>
<span id="cb2-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// The parameter theta, constrained to be between 0 and the minimum value</span></span>
<span id="cb2-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// of t.</span></span>
<span id="cb2-9">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">real</span>&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lower</span>=<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">upper</span>=min(t)&gt; theta; </span>
<span id="cb2-10">}</span>
<span id="cb2-11"></span>
<span id="cb2-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">model</span> {</span>
<span id="cb2-13">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// We don't explicitly write a prior for theta. Stan will assume theta</span></span>
<span id="cb2-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// has a flat prior on (0, min(t)).</span></span>
<span id="cb2-15"></span>
<span id="cb2-16">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// We specify a prior for each observation. Stan has a helpful syntax</span></span>
<span id="cb2-17">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// for specifying truncated distributions.</span></span>
<span id="cb2-18">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (n <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:N) {</span>
<span id="cb2-19">        t[n] ~ exponential(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">T</span>[theta, ];</span>
<span id="cb2-20">    }</span>
<span id="cb2-21">}</span></code></pre></div>
</div>
<p>We can break this syntax down by its blocks:</p>
<ul>
<li><p>The <code>data</code> block is used to declare the data that will be input to the model. In this case, there are two data inputs: <code>N</code>, an integer representing the number of observations, and <code>t</code>, an array of real numbers representing the observations themselves. We will provide these values to the program when we run it.</p></li>
<li><p>The <code>parameters</code> block is used to declare parameters used in the statistical model, which do not need to be provided by the user. In this case, there is one parameter, <code>theta</code>, which we are estimating, and we specify it is a real number constrained to be between 0 and the minimum value of <code>t</code>.</p></li>
<li><p>The <code>model</code> block is used to specify the statistical model – this is typically done by specifying the probability distribution of the data and the relationships to the defined parameters. In this case we specify a prior density for each observation <code>t[n]</code>. We use the <code>exponential</code> distribution, and set <img src="https://latex.codecogs.com/png.latex?%5Clambda%20=%201">. We also specify that the <a href="https://mc-stan.org/docs/reference-manual/sampling-statements.html#truncated-distributions">distribution is truncated</a> at <img src="https://latex.codecogs.com/png.latex?%5Ctheta">, using the <code>T[theta, ]</code> syntax, which is how we achieve specifying the shifted exponential distribution.</p></li>
</ul>
<p>We can run the model using the <code>rstan</code> package in R. We provide the data inputs <code>N</code> and <code>t</code> and run the model for 20,000 iterations, using 4 chains.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rstan)</span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb3-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">options</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mc.cores =</span> parallel<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">detectCores</span>())</span>
<span id="cb3-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rstan_options</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">auto_write =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb3-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)</span>
<span id="cb3-6"></span>
<span id="cb3-7">N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb3-8">t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)</span>
<span id="cb3-9"></span>
<span id="cb3-10">fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sampling</span>(model, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N =</span> N, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t =</span> t), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">iter =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">chains =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb3-11"></span>
<span id="cb3-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(fit)</span>
<span id="cb3-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Inference for Stan model: anon_model.</span></span>
<span id="cb3-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 4 chains, each with iter=20000; warmup=10000; thin=1; </span></span>
<span id="cb3-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; post-warmup draws per chain=10000, total post-warmup draws=40000.</span></span>
<span id="cb3-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; </span></span>
<span id="cb3-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;        mean se_mean   sd  2.5%   25%   50%   75% 97.5% n_eff Rhat</span></span>
<span id="cb3-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; theta 11.67    0.00 0.34 10.78 11.55 11.78 11.91 11.99 15295    1</span></span>
<span id="cb3-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; lp__  33.29    0.01 0.81 30.98 33.08 33.60 33.81 33.87  9341    1</span></span>
<span id="cb3-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; </span></span>
<span id="cb3-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; Samples were drawn using NUTS(diag_e) at Wed May 29 21:47:55 2024.</span></span>
<span id="cb3-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; For each parameter, n_eff is a crude measure of effective sample size,</span></span>
<span id="cb3-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; and Rhat is the potential scale reduction factor on split chains (at </span></span>
<span id="cb3-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; convergence, Rhat=1).</span></span></code></pre></div>
</div>
<p>The model gives a nice summary of the results, including the mean, standard deviation, and quantiles for each parameter. We can see here that the model has provided a central estimate of <img src="https://latex.codecogs.com/png.latex?%5Ctheta"> to be 11.67.</p>
<p>We can use R to access the samples from the model and plot the posterior probability density for <img src="https://latex.codecogs.com/png.latex?%5Ctheta"> using a histogram.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">extract</span>(fit)</span>
<span id="cb4-2">samples <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tibble<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_tibble</span>(params)</span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hist</span>(samples[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"theta"</span>]])</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://rossbowen.github.io/blog/how-long-will-my-machine-last/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>We can use the samples generated from our Monte Carlo simulation to estimate the probability that <img src="https://latex.codecogs.com/png.latex?%5Ctheta"> is between 11.23 and 12:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">samples <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(theta) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">11.23</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> theta <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> theta <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prop =</span> n <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(n))</span>
<span id="cb5-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; # A tibble: 2 × 3</span></span>
<span id="cb5-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   `11.23 &lt; theta &amp; theta &lt; 12`     n   prop</span></span>
<span id="cb5-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt;   &lt;lgl&gt;                        &lt;int&gt;  &lt;dbl&gt;</span></span>
<span id="cb5-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 1 FALSE                         3969 0.0992</span></span>
<span id="cb5-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#&gt; 2 TRUE                         36031 0.901</span></span></code></pre></div>
</div>
<p>The results tell us that 90.1% of the simulated samples of <img src="https://latex.codecogs.com/png.latex?%5Ctheta"> are in this range, which shows that 11.12 and 12 is a 90% credible interval for <img src="https://latex.codecogs.com/png.latex?%5Ctheta">. We’ve managed to reproduce the result from the Jaynes paper!</p>


</section>

 ]]></description>
  <guid>https://rossbowen.github.io/blog/how-long-will-my-machine-last/</guid>
  <pubDate>Tue, 31 Oct 2023 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Confidence intervals in the wild</title>
  <link>https://rossbowen.github.io/blog/confidence-intervals-in-the-wild/</link>
  <description><![CDATA[ 




<p>Confidence intervals have always come up during interviews for analytical roles. I’m usually asked what a confidence interval is, and I’ll respond along the lines of the <a href="https://www.ons.gov.uk/methodology/methodologytopicsandstatisticalconcepts/uncertaintyandhowwemeasureit#confidence-interval">definition given by the Office for National Statistics</a>.</p>
<blockquote class="blockquote">
<p><strong>Using a 95% confidence interval</strong></p>
<p>A 95% confidence level is frequently used. This means that if we drew 20 random samples and calculated a 95% confidence interval for each sample using the data in that sample, we would expect that, on average, 19 out of the 20 (95%) resulting confidence intervals would contain the true population value and 1 in 20 (5%) would not. If we increased the confidence level to 99%, wider intervals would be obtained.</p>
</blockquote>
<p>This definition aligns with that I was taught – if we took many samples and created many 95% confidence intervals, we’d expect 95% of those intervals to contain the true value for the parameter of interest. For many X% confidence intervals, we’d expect X% of the intervals to contain the true value.</p>
<p>I’ve then been asked how I would help a non-technical audience interpret a specific confidence interval. The thing is, I’ve never felt that confidence intervals are a good thing to use with that kind of audience. Many <a href="https://statmodeling.stat.columbia.edu/2017/12/28/stupid-ass-statisticians-dont-know-goddam-confidence-interval/">statisticians misinterpret them</a>, so how we could expect a non-technical audience to use them correctly?</p>
<p>I’ve gotten into some awkward debates over this – so here’s me getting my thoughts together.</p>
<section id="what-does-a-confidence-interval-actually-tell-you" class="level2">
<h2 class="anchored" data-anchor-id="what-does-a-confidence-interval-actually-tell-you">What does a confidence interval <em>actually</em> tell you?</h2>
<p>I’d see a confidence interval in the wild and feel a bit unsure of how I could interpret it. If the definition of a confidence interval describes a behavior across <em>many</em> intervals, what does it mean when we’re presented with a <em>single</em> interval?</p>
<p>A quick google and we see some common interpretations of confidence intervals:</p>
<ul>
<li>There’s a 95% chance that the parameter of interest lies within a 95% confidence interval.</li>
<li>Confidence intervals are a range in which we think the true value is likely to lie.</li>
</ul>
<p>I couldn’t see how either of these followed from the definition we used earlier, about creating many intervals and on average X% of them containing the true value. I went searching and found many blog posts on the subject from <a href="https://statmodeling.stat.columbia.edu/">Andrew Gelman</a>, one of which introduced <a href="https://statmodeling.stat.columbia.edu/wp-content/uploads/2014/09/fundamentalError.pdf">this paper from Richard Morey et al.</a> which has shaped my thoughts over the years.</p>
<hr>
<p>Take this example from some of the <a href="https://www.ons.gov.uk/peoplepopulationandcommunity/healthandsocialcare/conditionsanddiseases/bulletins/coronaviruscovid19infectionsurveycharacteristicsofpeopletestingpositiveforcovid19uk/16november2022">ONS’s COVID-19 reporting</a>:</p>
<blockquote class="blockquote">
<p>The latest estimated rate of coronavirus (COVID-19) reinfections on 28 October 2022 was 42.8 per 100,000 participant days at risk (95% confidence interval: 42.0 to 43.6).</p>
</blockquote>
<p>Here we have a single 95% interval reported alongside an estimate of the COVID-19 reinfection rate. Maybe this is one of the lucky intervals which contains the true reinfection rate, but maybe it’s not. We don’t know.</p>
<p>The idea behind the 95% confidence interval is to perform some procedure which, on average, returns intervals <img src="https://latex.codecogs.com/png.latex?(L,%20U)"> which contain the true parameter 95% of the time.</p>
<p><img src="https://latex.codecogs.com/png.latex?P(L(X)%20%5Cleq%20%5Ctheta%20%5Cleq%20U(X))%20=%200.95"></p>
<p>We write <img src="https://latex.codecogs.com/png.latex?L(X)"> and <img src="https://latex.codecogs.com/png.latex?U(X)"> to emphasise these are random variables which in practice will often depend on the data. The problem occurs when we try to replace <img src="https://latex.codecogs.com/png.latex?(L(X),%20U(X))"> with an actual interval we’ve obtained.</p>
<p>If <img src="https://latex.codecogs.com/png.latex?%5Ctheta"> was the true COVID-19 reinfection rate, <img src="https://latex.codecogs.com/png.latex?%5Ctheta"> is just some fixed number we don’t know the value of. We can’t say anything probabilistic about the value of <img src="https://latex.codecogs.com/png.latex?%5Ctheta"> (unless we start using Bayesian techniques).</p>
<p>But, if we replace <img src="https://latex.codecogs.com/png.latex?L(X)"> and <img src="https://latex.codecogs.com/png.latex?U(X)"> above with the obtained interval, the probability changes.</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%20%20P(42.0%20%5Cleq%20%5Ctheta%20%5Cleq%2043.6)%20=%20%5Cbegin%7Bcases%7D%0A%20%20%20%201,%20&amp;%20%5Ctext%7Bif%20%7D%2042.0%20%5Cleq%20%5Ctheta%20%5Cleq%2043.6,%20%5C%5C%0A%20%20%20%200,%20&amp;%20%5Ctext%7Botherwise%7D.%0A%20%20%5Cend%7Bcases%7D%0A"></p>
<p>Andrew Gelman provides an analogy in <a href="https://statmodeling.stat.columbia.edu/2016/11/23/abraham-lincoln-confidence-intervals/">a blog post</a> to explain why the probability changes once you substitute actual values into the interval. To provide a similar analogy – let’s say 170cm is a fairly average male height – we could imagine that half of men are taller and half are shorter than 170cm. Bob is 168cm tall.</p>
<p>It seems reasonable to say, if <img src="https://latex.codecogs.com/png.latex?X"> was the height of some arbitrary man, that the probability of that man being taller than 170cm is a half.</p>
<p><img src="https://latex.codecogs.com/png.latex?P(X%20%3E%20170%5Ctext%7Bcm%7D)%20=%200.5."></p>
<p>But we can’t just replace <img src="https://latex.codecogs.com/png.latex?X">, which represents the height of some arbitrary man. with Bob’s height and expect the probability to remain the same. If we condition the above probability to talk specifically about Bob, rather than some arbitrary man, then the probability becomes 0, as Bob is shorter than 170cm.</p>
<p><img src="https://latex.codecogs.com/png.latex?P(X%20%3E%20170%5Ctext%7Bcm%7D%20%5Cmid%20X%20=%20%5Ctext%7BBob's%20height%7D)%20=%20P(168%5Ctext%7Bcm%7D%20%3E%20170%5Ctext%7Bcm%7D)%20=%200."></p>
<p>Jerzy Neyman (<a href="https://royalsocietypublishing.org/doi/epdf/10.1098/rsta.1937.0005">who introduced confidence intervals in this 1937 paper</a>) was so clear about their interpretation:</p>
<blockquote class="blockquote">
<p>It will be noticed that in the above description the probability statements refer to the problems of estimation with which the statistician will be concerned in the future. In fact, I have repeatedly stated that the frequency of correct results will tend to <img src="https://latex.codecogs.com/png.latex?%5Calpha">. Consider now the case when a sample <img src="https://latex.codecogs.com/png.latex?E'">, is already drawn, and the calculations have given <img src="https://latex.codecogs.com/png.latex?%5Cunderset%7B%5Cbar%7B%7D%7D%7B%5Ctheta%7D(E')%20=%201"> and <img src="https://latex.codecogs.com/png.latex?%5Cbar%7B%5Ctheta%7D(E')%20=%202">. <strong>Can we say that in this particular case the probability of the true value falling between 1 and 2 is equal to</strong> <img src="https://latex.codecogs.com/png.latex?%5Calpha">?</p>
<p><strong>The answer is obviously in the negative.</strong> The parameter <img src="https://latex.codecogs.com/png.latex?%5Ctheta_1"> is an unknown constant, and no probability statement concerning its value may be made, that is except for hypothetical and trivial ones</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Bequation%7D%20%5Ctag%7B21%7D%0A%20%20P(1%20%5Cleq%20%5Ctheta_1%20%5Cleq%202)%20=%20%5Cbegin%7Bcases%7D%0A%20%20%20%201,%20&amp;%20%5Ctext%7Bif%20%7D%201%20%5Cleq%20%5Ctheta_1%20%5Cleq%202,%20%5C%5C%0A%20%20%20%200,%20&amp;%20%5Ctext%7Bif%20either%20%7D%20%5Ctheta_1%20%5Cleq%202%20%5Ctext%7B%20or%20%7D%202%20%5Cgeq%20%5Ctheta_1.%0A%20%20%5Cend%7Bcases%7D%0A%5Cend%7Bequation%7D%0A"></p>
</blockquote>
<hr>
<p>To sum up – we can’t say that <em>all</em> confidence intervals give a range of likely values for some parameter, at least not from the definition of a confidence interval alone. <em>Some</em> confidence intervals may be sensible to interpret as a Bayesian credible intervals, at which point we could make statements about likely values.</p>
<p>Or as Morey et al.&nbsp;put it:</p>
<blockquote class="blockquote">
<p>In the case where data are normally distributed, for instance, there is a particular prior that will lead to a confidence interval that is numerically identical to Bayesian credible intervals computed using the Bayesian posterior (Jeffreys, 1961; Lindley, 1965). This might lead one to suspect that it does not matter whether one uses confidence procedures or Bayesian procedures. We showed, however, that confidence intervals and credible intervals can disagree markedly. The only way to know that a confidence interval is numerically identical to some credible interval is to prove it. The correspondence cannot – and should not – be assumed.</p>
</blockquote>
</section>
<section id="closing-thoughts" class="level2">
<h2 class="anchored" data-anchor-id="closing-thoughts">Closing thoughts</h2>
<p>I think that confidence intervals have a use, particularly when the procedures to create them provide intervals which help describe the uncertainty in an estimate. But I’d be nervous to include them when writing for non-technical audiences, mainly due to the risk of misinterpretation:</p>
<ul>
<li>A specific 95% confidence interval doesn’t cover the true value with 95% probability, but many readers will see an interval and assume that.</li>
<li>A confidence interval doesn’t give a range of likely values for some parameter, unless it is appropriate to interpret it as a Bayesian credible interval – which a non-technical audience wouldn’t be familiar with. A reader may assume all intervals provide likely values, regardless of the underlying statistical model being applied.</li>
<li>The Morey et al.&nbsp;paper also covers how smaller confidence intervals don’t necessarily mean more precise estimates, which is another common misinterpretation (with some more discussion <a href="https://stats.stackexchange.com/questions/204530/what-do-confidence-intervals-say-about-precision-if-anything">here</a>). It’s true for <em>some</em> intervals.</li>
<li>Also, readers may not appreciate the difference between precision and accuracy, and think an estimate is better and assign more trust to it just because it’s precise, even if it’s completely inaccurate.</li>
</ul>
<p>Other gotchas I think make confidence intervals difficult to interpret:</p>
<ul>
<li>What does it mean to be confident anyway? What is a confidence level? Do most people interpret being confident in a confidence interval as meaning the interval is likely to contain the true value?</li>
<li>There’s some real mental gymnastics to remember that a 99% confidence interval is wider than a 95% confidence interval. A 99% interval is wider, so there’s more uncertainty, but we’re now 99% confident instead of 95% confident. 🤷 To me, being more confident would meaning being able to provide a narrower interval with less uncertainty.</li>
<li>When two confidence intervals do not overlap, it means that the difference between the two parameters is statistically significant. But when two confidence intervals do overlap, they may or may not be significantly different. Overlapping intervals are often interpreted as meaning that the difference is not statistically significant, but this is not always the case.</li>
</ul>
<p>If I were to include confidence intervals in my writing then I’d expect the audience to have some level of technical knowledge, and I think it’s important to include what procedure has been used to compute the interval. If we think it is reasonable to interpret the interval as a Bayesian credible interval, then we can tell the audience that’s what we’re doing, and also include information about the prior we’ve used as part of our methodology.</p>
</section>
<section id="more-reading" class="level2">
<h2 class="anchored" data-anchor-id="more-reading">More reading</h2>
<p>Some posts from Andrew Gelman’s blog:</p>
<ul>
<li><a href="https://statmodeling.stat.columbia.edu/2014/03/15/problematic-interpretations-confidence-intervals/">Problematic interpretations of confidence intervals</a></li>
<li><a href="https://statmodeling.stat.columbia.edu/2016/11/23/abraham-lincoln-confidence-intervals/">Abraham Lincoln and confidence intervals</a></li>
<li><a href="https://statmodeling.stat.columbia.edu/2017/03/04/interpret-confidence-intervals/">How to interpret confidence intervals?</a></li>
<li><a href="https://statmodeling.stat.columbia.edu/2022/04/05/confidence-intervals-compatability-intervals-uncertainty-intervals/">Confidence intervals, compatability intervals, uncertainty intervals</a></li>
</ul>
<p>Two papers from Richard Morey et al.</p>
<ul>
<li><a href="https://www.ejwagenmakers.com/inpress/HoekstraEtAlPBR.pdf">Robust misinterpretation of confidence intervals</a></li>
<li><a href="https://statmodeling.stat.columbia.edu/wp-content/uploads/2014/09/fundamentalError.pdf">The fallacy of placing confidence in confidence intervals</a></li>
</ul>


</section>

 ]]></description>
  <guid>https://rossbowen.github.io/blog/confidence-intervals-in-the-wild/</guid>
  <pubDate>Tue, 05 Sep 2023 23:00:00 GMT</pubDate>
</item>
</channel>
</rss>
